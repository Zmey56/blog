<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Analyses of Product Metrics</h1><p class="page-description">Analyses of Product Metrics</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2022-08-05T00:00:00-05:00" itemprop="datePublished">
        Aug 5, 2022
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      6 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#data analysis">data analysis</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#mysql">mysql</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#superset">superset</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#BI">BI</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
</ul><p>This is a continuation of my last publication A Data Analysis in business - BI system and visualization.
In many publications on the Internet, you can find posts that there is little use from our metrics of user activity at different time intervals - on MAU, DAU, WAU. This is due to the fact that this “user activity” may not mean real user interest in our product. The growth of these metrics may be artificial and not reflect long-term engagement. This is due to the fact that there are various ways to attract a user (promotional promotions, bots, forced subscription, etc.). Here comes the second important question - how many users remain? This can be found out using the retention rate indicator.</p>

<p><img src="https://raw.githubusercontent.com/Zmey56/blog/master/_posts/images/Analyses_of_Product_Metrics/img_1.png" alt="image"></p>

<p>There are two types of users in our news feed usage data: those who came through paid traffic source = ‘ads’, and those who came through organic channels source = ‘organic’. Our task is to analyze and compare the Retention of these two groups of users.
This time we will build a graph - heat map. We also need to make a request to the database, the response to which will contain the date of the first use of our application by the user and how many days he had interest. The requests are of the same type, only the source changes. The selection of twenty days is connected with the fact that our schedule is visually readable.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">toString</span><span class="p">(</span><span class="nb">date</span><span class="p">)</span> <span class="k">AS</span> <span class="nb">date</span><span class="p">,</span> 
        <span class="n">toString</span><span class="p">(</span><span class="n">start_date</span><span class="p">)</span> <span class="k">AS</span> <span class="n">start_date</span><span class="p">,</span>
        <span class="n">countIf</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="k">source</span><span class="o">=</span><span class="s1">'organic'</span><span class="p">)</span> <span class="k">AS</span> <span class="n">active_user_organic</span><span class="p">,</span>
        <span class="n">countIf</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="k">source</span><span class="o">=</span><span class="s1">'ads'</span><span class="p">)</span> <span class="k">AS</span> <span class="n">active_user_ads</span><span class="p">,</span>
        <span class="p">(</span><span class="n">countIf</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="k">source</span><span class="o">=</span><span class="s1">'ads'</span><span class="p">)</span><span class="o">/</span><span class="n">countIf</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="k">source</span><span class="o">=</span><span class="s1">'organic'</span><span class="p">))</span> <span class="k">AS</span> <span class="n">rate</span>  
<span class="k">FROM</span> 

<span class="p">(</span><span class="k">SELECT</span> <span class="n">user_id</span><span class="p">,</span> <span class="k">min</span><span class="p">(</span><span class="n">toDate</span><span class="p">(</span><span class="nb">time</span><span class="p">))</span> <span class="k">AS</span> <span class="n">start_date</span><span class="p">,</span> <span class="k">any</span><span class="p">(</span><span class="k">source</span><span class="p">)</span> <span class="k">as</span> <span class="k">source</span> 
<span class="k">FROM</span> <span class="n">simulator_20220620</span><span class="p">.</span><span class="n">feed_actions</span> 
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">user_id</span>
<span class="k">HAVING</span> <span class="n">start_date</span> <span class="o">&gt;=</span> <span class="n">today</span><span class="p">()</span><span class="o">-</span><span class="mi">20</span>
<span class="p">)</span> <span class="n">t1</span>

<span class="k">JOIN</span>

<span class="p">(</span><span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">toDate</span><span class="p">(</span><span class="nb">time</span><span class="p">)</span> <span class="k">AS</span> <span class="nb">date</span>
<span class="k">FROM</span> <span class="n">simulator_20220620</span><span class="p">.</span><span class="n">feed_actions</span><span class="p">)</span> <span class="n">t2</span>

<span class="k">USING</span> <span class="n">user_id</span> 

<span class="k">GROUP</span> <span class="k">BY</span> <span class="nb">date</span><span class="p">,</span> <span class="n">start_date</span>
</code></pre></div></div>

<p>Next, select the graphs as we did in the last post and instead of the database, select our query and the heatmap graph type.</p>

<p><img src="https://raw.githubusercontent.com/Zmey56/blog/master/_posts/images/Analyses_of_Product_Metrics/img_2.png" alt="image"></p>

<p>In the X AXIS field, select the date field, Y AXIS - start_data. In the METRIC field, since we just need to get a number, we can choose the MAX aggregation function (it does not affect anything in this case) and as the value of active_user_ads or active_user_organic, depending on which graph we want to build. Then you can change the color of the graph in the LINEAR COLOR SCHEME field. Also, in the NORMALIZE CROSS field, select that normalization will be on the y axis and do not forget to select SHOW VALUES .</p>

<p><img src="https://raw.githubusercontent.com/Zmey56/blog/master/_posts/images/Analyses_of_Product_Metrics/img_3.png" alt="image"></p>

<p>After clicking on the RUN QUERY button, we get graphs on which we can analyze the outflow of our users.</p>

<p><img src="https://raw.githubusercontent.com/Zmey56/blog/master/_posts/images/Analyses_of_Product_Metrics/img_4.png" alt="image"></p>

<p><img src="https://raw.githubusercontent.com/Zmey56/blog/master/_posts/images/Analyses_of_Product_Metrics/img_5.png" alt="image"></p>

<p>From the data obtained, it can be concluded that users who came through advertising lose interest in the application faster. There is sometimes a surge in their activity. But perhaps this is due to repeated advertising.
The next stage, where our knowledge was required, was to analyze the quality of the advertising carried out by marketers in order to attract users. There was a clear surge of new users on the day of advertising, but it is unknown how long their interest remained. The promotion was held on June 06, 2022.
At the first step, we will create a query to our database and get data on users who registered on that day.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">SELECT</span> 
  <span class="k">data</span><span class="p">,</span> 
  <span class="n">countIf</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="k">source</span><span class="o">=</span><span class="s1">'ads'</span><span class="p">)</span> <span class="k">AS</span> <span class="n">count_user_ads</span><span class="p">,</span>  
  <span class="n">countIf</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="k">source</span><span class="o">=</span><span class="s1">'organic'</span><span class="p">)</span> <span class="k">AS</span> <span class="n">count_user_organic</span> 
<span class="k">FROM</span>

<span class="p">(</span><span class="k">SELECT</span> <span class="n">user_id</span><span class="p">,</span> <span class="k">min</span><span class="p">(</span><span class="n">toDate</span><span class="p">(</span><span class="nb">time</span><span class="p">))</span> <span class="k">AS</span> <span class="n">start_data</span><span class="p">,</span> <span class="k">source</span>
<span class="k">FROM</span> <span class="n">simulator_20220620</span><span class="p">.</span><span class="n">feed_actions</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">user_id</span><span class="p">,</span> <span class="k">source</span>
<span class="k">HAVING</span> <span class="k">min</span><span class="p">(</span><span class="n">toDate</span><span class="p">(</span><span class="nb">time</span><span class="p">))</span> <span class="o">=</span> <span class="s1">'2022-06-06'</span><span class="p">)</span> <span class="n">t1</span>

<span class="k">JOIN</span> 

<span class="p">(</span><span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">toDate</span><span class="p">(</span><span class="nb">time</span><span class="p">)</span> <span class="k">as</span> <span class="k">data</span>
<span class="k">FROM</span> <span class="n">simulator_20220620</span><span class="p">.</span><span class="n">feed_actions</span><span class="p">)</span> <span class="n">t2</span>

<span class="k">USING</span> <span class="n">user_id</span>

<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">data</span><span class="p">,</span> <span class="k">source</span>

<span class="k">ORDER</span> <span class="k">BY</span> <span class="k">data</span>
</code></pre></div></div>

<p>Next, we select our query as a data source and the type of chart - bar chart. In metrics, we again select the MAX function separately for the count_user_ads and count_user_organic columns. After that, we rename them in order to visually look more aesthetically pleasing.</p>

<p><img src="https://raw.githubusercontent.com/Zmey56/blog/master/_posts/images/Analyses_of_Product_Metrics/img_6.jpeg" alt="image"></p>

<p>On June 06, 2022, there was a surge in attracted users as well, but the next day there was a sharp decline in both groups. At the same time, it is important to note that the number of advertising users is decreasing daily, while ordinary users, having fallen to an average value, are kept at the same level. We can say that the advertising campaign failed.
Then on June 15 there was a sharp drop in the active audience and we were instructed to deal with the cause of the fall.</p>

<p><img src="https://raw.githubusercontent.com/Zmey56/blog/master/_posts/images/Analyses_of_Product_Metrics/img_7.jpeg" alt="image"></p>

<p>I have plotted the distribution of the active audience depending on gender and operating system</p>

<p><img src="https://raw.githubusercontent.com/Zmey56/blog/master/_posts/images/Analyses_of_Product_Metrics/img_8.jpeg" alt="image"></p>

<p><img src="https://raw.githubusercontent.com/Zmey56/blog/master/_posts/images/Analyses_of_Product_Metrics/img_9.jpeg" alt="image"></p>

<p>As can be seen from the graphs obtained, the fall occurred proportionally in both categories, from which it was concluded that these characteristics are not the cause of the fall.
Then I moved on to the analysis separately by country. Since there are significantly more users in Russia than in other countries, I put it on a separate chart.</p>

<p><img src="https://raw.githubusercontent.com/Zmey56/blog/master/_posts/images/Analyses_of_Product_Metrics/img_10.jpeg" alt="image"></p>

<p><img src="https://raw.githubusercontent.com/Zmey56/blog/master/_posts/images/Analyses_of_Product_Metrics/img_11.jpeg" alt="image"></p>

<p>From these graphs, it can already be concluded that a significant drop in active users is due to Russia.
Let’s go deeper and get a sample by city. The visual representation will not give us the necessary information. Therefore, we will output the result to the table using an SQL query.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">SELECT</span> <span class="n">city</span><span class="p">,</span> 
      <span class="n">uniqIf</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">toDate</span><span class="p">(</span><span class="nb">time</span><span class="p">)</span> <span class="o">=</span><span class="s1">'2022-06-14'</span> <span class="p">)</span> <span class="k">as</span> <span class="n">day_0</span><span class="p">,</span>
      <span class="n">uniqIf</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">toDate</span><span class="p">(</span><span class="nb">time</span><span class="p">)</span> <span class="o">=</span><span class="s1">'2022-06-15'</span><span class="p">)</span> <span class="k">as</span> <span class="n">day_1</span><span class="p">,</span>
      <span class="n">uniqIf</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">toDate</span><span class="p">(</span><span class="nb">time</span><span class="p">)</span> <span class="o">=</span><span class="s1">'2022-06-16'</span><span class="p">)</span> <span class="k">as</span> <span class="n">day_2</span><span class="p">,</span>
      <span class="n">day_0</span> <span class="o">-</span> <span class="n">day_1</span> <span class="k">as</span> <span class="n">diff_1</span><span class="p">,</span>
      <span class="n">day_2</span> <span class="o">-</span> <span class="n">day_1</span> <span class="k">as</span> <span class="n">diff_2</span>
<span class="k">FROM</span> <span class="n">simulator_20220620</span><span class="p">.</span><span class="n">feed_actions</span> 
<span class="k">WHERE</span> <span class="n">country</span> <span class="o">=</span> <span class="s1">'Russia'</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">city</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">diff_1</span> <span class="k">DESC</span><span class="p">,</span>  <span class="n">day_0</span> <span class="k">DESC</span> 
</code></pre></div></div>

<p>As a result , we get the following table:</p>

<p><img src="https://raw.githubusercontent.com/Zmey56/blog/master/_posts/images/Analyses_of_Product_Metrics/img_12.png" alt="image"></p>

<p>From it it becomes clear to us that the drop on this day is due to the lack of active users from large cities. Then this data can be transferred to the technical department or the department of attracting and retaining customers.
The last step is to create a graph that shows an active audience from the point of view of new, old and departed users:</p>

<ul>
  <li>New - the first activity in the feed was this week.</li>
  <li>The old ones - there was activity both this week and last week.</li>
  <li>Gone - the activity was last week, this was not.</li>
</ul>

<p>To do this, create the following query to the database:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">SELECT</span> <span class="n">this_week</span><span class="p">,</span> <span class="n">previous_week</span><span class="p">,</span> <span class="o">-</span><span class="n">uniq</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span> <span class="k">as</span> <span class="n">num_users</span><span class="p">,</span> <span class="n">status</span> <span class="k">FROM</span>

<span class="p">(</span><span class="k">SELECT</span> <span class="n">user_id</span><span class="p">,</span> 
<span class="n">groupUniqArray</span><span class="p">(</span><span class="n">toMonday</span><span class="p">(</span><span class="n">toDate</span><span class="p">(</span><span class="nb">time</span><span class="p">)))</span> <span class="k">as</span> <span class="n">weeks_visited</span><span class="p">,</span> 
<span class="n">addWeeks</span><span class="p">(</span><span class="n">arrayJoin</span><span class="p">(</span><span class="n">weeks_visited</span><span class="p">),</span> <span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="n">this_week</span><span class="p">,</span> 
<span class="n">if</span><span class="p">(</span><span class="n">has</span><span class="p">(</span><span class="n">weeks_visited</span><span class="p">,</span> <span class="n">this_week</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'retained'</span><span class="p">,</span> <span class="s1">'gone'</span><span class="p">)</span> <span class="k">as</span> <span class="n">status</span><span class="p">,</span> 
<span class="n">addWeeks</span><span class="p">(</span><span class="n">this_week</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">as</span> <span class="n">previous_week</span>
<span class="k">FROM</span> <span class="n">simulator_20220620</span><span class="p">.</span><span class="n">feed_actions</span>
<span class="k">group</span> <span class="k">by</span> <span class="n">user_id</span><span class="p">)</span>

<span class="k">where</span> <span class="n">status</span> <span class="o">=</span> <span class="s1">'gone'</span>

<span class="k">group</span> <span class="k">by</span> <span class="n">this_week</span><span class="p">,</span> <span class="n">previous_week</span><span class="p">,</span> <span class="n">status</span>

<span class="k">HAVING</span> <span class="n">this_week</span> <span class="o">!=</span> <span class="n">addWeeks</span><span class="p">(</span><span class="n">toMonday</span><span class="p">(</span><span class="n">today</span><span class="p">()),</span> <span class="o">+</span><span class="mi">1</span><span class="p">)</span>

<span class="k">union</span> <span class="k">all</span>


<span class="k">SELECT</span> <span class="n">this_week</span><span class="p">,</span> <span class="n">previous_week</span><span class="p">,</span> <span class="n">toInt64</span><span class="p">(</span><span class="n">uniq</span><span class="p">(</span><span class="n">user_id</span><span class="p">))</span> <span class="k">as</span> <span class="n">num_users</span><span class="p">,</span> <span class="n">status</span> <span class="k">FROM</span>

<span class="p">(</span><span class="k">SELECT</span> <span class="n">user_id</span><span class="p">,</span> 
<span class="n">groupUniqArray</span><span class="p">(</span><span class="n">toMonday</span><span class="p">(</span><span class="n">toDate</span><span class="p">(</span><span class="nb">time</span><span class="p">)))</span> <span class="k">as</span> <span class="n">weeks_visited</span><span class="p">,</span> 
<span class="n">arrayJoin</span><span class="p">(</span><span class="n">weeks_visited</span><span class="p">)</span> <span class="n">this_week</span><span class="p">,</span> 
<span class="n">if</span><span class="p">(</span><span class="n">has</span><span class="p">(</span><span class="n">weeks_visited</span><span class="p">,</span> <span class="n">addWeeks</span><span class="p">(</span><span class="n">this_week</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'retained'</span><span class="p">,</span> <span class="s1">'new'</span><span class="p">)</span> <span class="k">as</span> <span class="n">status</span><span class="p">,</span> 
<span class="n">addWeeks</span><span class="p">(</span><span class="n">this_week</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">as</span> <span class="n">previous_week</span>
<span class="k">FROM</span> <span class="n">simulator_20220620</span><span class="p">.</span><span class="n">feed_actions</span>
<span class="k">group</span> <span class="k">by</span> <span class="n">user_id</span><span class="p">)</span>

<span class="k">group</span> <span class="k">by</span> <span class="n">this_week</span><span class="p">,</span> <span class="n">previous_week</span><span class="p">,</span> <span class="n">status</span>
</code></pre></div></div>

<p>To build a chart, select VISUALIZATION TYPE - Time-series Bar Chart. In TIMECOLUMN we will choose this_week, and in TIMEGRAIN - Day. As a metric, we choose the aggregating function - AVG by num_users and group it by status. And as a result, we will have the following graph:</p>

<p><img src="https://raw.githubusercontent.com/Zmey56/blog/master/_posts/images/Analyses_of_Product_Metrics/img_13.png" alt="image"></p>

<p>This concludes the article on Analyses of Product Metrics. The next article will be devoted to A/B testing.</p>


  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="Zmey56/blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/data%20analysis/mysql/superset/bi/2022/08/05/analyses-of-product-metrics.html" hidden></a>
</article>